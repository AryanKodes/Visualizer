<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vibe OS | Hyper Fractal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script src="visualizer-template.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; cursor: none; }
        #ui { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; z-index: 100; background: #000; }
        .btn { padding: 20px 80px; border: 2px solid #00FF00; background: none; color: #00FF00; cursor: pointer; font-family: 'Courier New', monospace; font-size: 30px; letter-spacing: 12px; transition: 0.3s; }
        .btn:hover { background: #00FF00; color: #000; box-shadow: 0 0 50px #00FF00; }
    </style>
</head>
<body>
    <div id="ui"><label for="loader" class="btn">SYNC NEURAL LINK</label><input type="file" id="loader" accept="audio/*" style="display:none"></div>
    <audio id="audio-element" crossorigin="anonymous"></audio>

    <script>
        class HyperFractal extends AudioVisualizer {
            constructor() {
                super({
                    canvasMode: '2D',
                    audio: { fftSize: 512, beatThreshold: 230 }
                });
            }

            setupCanvas() {
                createCanvas(windowWidth, windowHeight);
                colorMode(HSB, 360, 100, 100, 100);
            }

            draw() {
                // Background with low alpha creates the "liquid" trail effect
                background(0, 0, 0, 10);
                
                if (!this.isPlaying || !this.analyzer) return;
                this.analyzer.getByteFrequencyData(this.dataArray);

                let bass = this.getBass();
                let mid = this.getMid();
                let treble = this.getTreble();

                translate(width / 2, height / 2);
                
                // Rotate the entire scene based on treble
                rotate(frameCount * map(treble, 0, 255, 0.001, 0.02));

                for (let i = 0; i < 8; i++) {
                    push();
                    rotate(TWO_PI / 8 * i);
                    
                    // Shift colors through the rainbow based on Mid frequencies
                    let hue = (frameCount + mid) % 360;
                    stroke(hue, 80, 100, 60);
                    strokeWeight(map(bass, 0, 255, 1, 10));
                    noFill();

                    beginShape();
                    for (let j = 0; j < 60; j += 5) {
                        let r = map(this.dataArray[j], 0, 255, 10, 500);
                        let x = sin(j + frameCount * 0.1) * r;
                        let y = cos(j + frameCount * 0.1) * r;
                        bezierVertex(x, y, y, x, x*1.5, y*1.5);
                    }
                    endShape();
                    pop();
                }

                if (this.isBeat()) {
                    filter(INVERT); // Flash effect on heavy bass
                }
            }
        }

        let visualizer;
        function setup() { visualizer = new HyperFractal(); visualizer.setupCanvas(); }
        function draw() { visualizer.draw(); }
        function windowResized() { resizeCanvas(windowWidth, windowHeight); }
    </script>
</body>
</html>