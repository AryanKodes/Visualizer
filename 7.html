<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vibe OS | Cosmic Rift</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script src="visualizer-template.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        #ui { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; z-index: 100; background: #000; }
        .btn { padding: 20px 60px; border: 2px solid #00FF00; background: none; color: #00FF00; cursor: pointer; font-family: 'Courier New', monospace; letter-spacing: 5px; }
    </style>
</head>
<body>
    <div id="ui"><label for="loader" class="btn">ENTER THE RIFT</label><input type="file" id="loader" accept="audio/*" style="display:none"></div>
    <audio id="audio-element" crossorigin="anonymous"></audio>

    <script>
        class CosmicRift extends AudioVisualizer {
            constructor() {
                super({ canvasMode: '2D' });
                this.rings = [];
            }

            setupCanvas() { createCanvas(windowWidth, windowHeight); }

            draw() {
                background(0, 40);
                if (!this.isPlaying || !this.analyzer) return;
                this.analyzer.getByteFrequencyData(this.dataArray);

                const bass = this.getBass();
                translate(width/2, height/2);

                // Add a new ring on every frame, size starts small
                if (frameCount % 2 === 0) {
                    this.rings.push({ r: 10, opacity: 255, freqIdx: floor(random(0, 100)) });
                }

                for (let i = this.rings.length - 1; i >= 0; i--) {
                    let ring = this.rings[i];
                    let volumeEffect = this.dataArray[ring.freqIdx];
                    
                    noFill();
                    stroke(0, 255, 0, ring.opacity);
                    strokeWeight(map(volumeEffect, 0, 255, 1, 8));
                    
                    // The "Psychedelic" shape morphing
                    beginShape();
                    for(let a = 0; a < TWO_PI; a += 0.5) {
                        let offset = map(volumeEffect, 0, 255, -20, 20);
                        let x = (ring.r + offset) * cos(a);
                        let y = (ring.r + offset) * sin(a);
                        vertex(x, y);
                    }
                    endShape(CLOSE);

                    ring.r *= 1.05; // Expand outward
                    ring.opacity -= 2; // Fade out

                    if (ring.opacity <= 0) this.rings.splice(i, 1);
                }
            }
        }

        let visualizer;
        function setup() { visualizer = new CosmicRift(); visualizer.setupCanvas(); }
        function draw() { visualizer.draw(); }
    </script>
</body>
</html>